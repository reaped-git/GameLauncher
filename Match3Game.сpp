#pragma once

namespace GameLauncher {

	using namespace System;
	using namespace System::ComponentModel;
	using namespace System::Collections;
	using namespace System::Windows::Forms;
	using namespace System::Data;
	using namespace System::Drawing;
	using namespace System::Collections::Generic;

	// Игра "2048" - математическая головоломка
	public ref class G2048 : public System::Windows::Forms::Form
	{
	public:
		G2048();
		~G2048();

	private:
		// приватные переменные

		// Переменные управления окном
		System::Boolean dragging;
		Point start_point;

		// Игровые переменные
		Int32 size;                          // Размер поля (4x4)
		Int32 tileSize;                      // Размер плитки
		array<array<Int32>^>^ grid;          // Игровое поле с числами
		array<array<Label^>^>^ cellLabels;   // Визуальные элементы плиток
		Random^ rand;                        // Генератор случайных чисел
		System::Boolean initializing;        // Флаг инициализации

		// Элементы пользовательского интерфейса
		System::Windows::Forms::Panel^ toolBar;
		System::Windows::Forms::Button^ buttonClose;
		System::Windows::Forms::Button^ buttonMinimize;
		System::Windows::Forms::Label^ scoreLabel;
		System::ComponentModel::BackgroundWorker^ backgroundWorker1;
		System::Windows::Forms::Button^ buttonReset;
		System::Windows::Forms::Button^ buttonLeft;
		System::Windows::Forms::Button^ buttonDown;
		System::Windows::Forms::Button^ buttonUp;
		System::Windows::Forms::Button^ buttonRight;
		System::ComponentModel::Container^ components;

		// приватные методы
		void InitializeComponent(void)
		{
			this->toolBar = (gcnew System::Windows::Forms::Panel());
			this->buttonClose = (gcnew System::Windows::Forms::Button());
			this->buttonMinimize = (gcnew System::Windows::Forms::Button());
			this->scoreLabel = (gcnew System::Windows::Forms::Label());
			this->backgroundWorker1 = (gcnew System::ComponentModel::BackgroundWorker());
			this->buttonReset = (gcnew System::Windows::Forms::Button());
			this->buttonLeft = (gcnew System::Windows::Forms::Button());
			this->buttonDown = (gcnew System::Windows::Forms::Button());
			this->buttonUp = (gcnew System::Windows::Forms::Button());
			this->buttonRight = (gcnew System::Windows::Forms::Button());
			this->toolBar->SuspendLayout();
			this->SuspendLayout();
			// 
			// toolBar
			// 
			this->toolBar->BackColor = System::Drawing::Color::White;
			this->toolBar->Controls->Add(this->buttonClose);
			this->toolBar->Controls->Add(this->buttonMinimize);
			this->toolBar->Controls->Add(this->scoreLabel);
			this->toolBar->Location = System::Drawing::Point(1, 1);
			this->toolBar->Name = L"toolBar";
			this->toolBar->Size = System::Drawing::Size(243, 32);
			this->toolBar->TabIndex = 8;
			this->toolBar->MouseDown += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseDown);
			this->toolBar->MouseMove += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseMove);
			this->toolBar->MouseUp += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseUp);
			// 
			// buttonClose
			// 
			this->buttonClose->BackColor = System::Drawing::Color::White;
			this->buttonClose->FlatAppearance->BorderColor = System::Drawing::Color::Black;
			this->buttonClose->FlatAppearance->BorderSize = 0;
			this->buttonClose->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonClose->Font = (gcnew System::Drawing::Font(L"Microsoft Sans Serif", 16, System::Drawing::FontStyle::Bold));
			this->buttonClose->ForeColor = System::Drawing::Color::Black;
			this->buttonClose->Location = System::Drawing::Point(207, 0);
			this->buttonClose->Margin = System::Windows::Forms::Padding(0);
			this->buttonClose->Name = L"buttonClose";
			this->buttonClose->Size = System::Drawing::Size(36, 32);
			this->buttonClose->TabIndex = 4;
			this->buttonClose->Text = L"x";
			this->buttonClose->UseVisualStyleBackColor = false;
			this->buttonClose->Click += gcnew System::EventHandler(this, &G2048::buttonClose_Click);
			this->buttonClose->MouseEnter += gcnew System::EventHandler(this, &G2048::buttonClose_MouseEnter);
			this->buttonClose->MouseLeave += gcnew System::EventHandler(this, &G2048::buttonClose_MouseLeave);
			// 
			// buttonMinimize
			// 
			this->buttonMinimize->BackColor = System::Drawing::Color::White;
			this->buttonMinimize->FlatAppearance->BorderColor = System::Drawing::Color::Black;
			this->buttonMinimize->FlatAppearance->BorderSize = 0;
			this->buttonMinimize->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonMinimize->Font = (gcnew System::Drawing::Font(L"Microsoft Sans Serif", 15.75F, System::Drawing::FontStyle::Bold, System::Drawing::GraphicsUnit::Point,
				static_cast<System::Byte>(0)));
			this->buttonMinimize->ForeColor = System::Drawing::Color::Black;
			this->buttonMinimize->Location = System::Drawing::Point(170, 0);
			this->buttonMinimize->Margin = System::Windows::Forms::Padding(0);
			this->buttonMinimize->Name = L"buttonMinimize";
			this->buttonMinimize->Size = System::Drawing::Size(36, 32);
			this->buttonMinimize->TabIndex = 5;
			this->buttonMinimize->Text = L"_";
			this->buttonMinimize->UseVisualStyleBackColor = false;
			this->buttonMinimize->Click += gcnew System::EventHandler(this, &G2048::buttonMinimize_Click);
			// 
			// scoreLabel
			// 
			this->scoreLabel->Font = (gcnew System::Drawing::Font(L"Impact", 15.75F, System::Drawing::FontStyle::Regular, System::Drawing::GraphicsUnit::Point,
				static_cast<System::Byte>(0)));
			this->scoreLabel->ForeColor = System::Drawing::Color::Black;
			this->scoreLabel->Location = System::Drawing::Point(2, 2);
			this->scoreLabel->Margin = System::Windows::Forms::Padding(0);
			this->scoreLabel->Name = L"scoreLabel";
			this->scoreLabel->Size = System::Drawing::Size(109, 28);
			this->scoreLabel->TabIndex = 0;
			this->scoreLabel->Text = L"Score: ";
			this->scoreLabel->TextAlign = System::Drawing::ContentAlignment::MiddleLeft;
			this->scoreLabel->MouseDown += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseDown);
			this->scoreLabel->MouseMove += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseMove);
			this->scoreLabel->MouseUp += gcnew System::Windows::Forms::MouseEventHandler(this, &G2048::toolBar_MouseUp);
			// 
			// buttonReset
			// 
			this->buttonReset->BackColor = System::Drawing::Color::White;
			this->buttonReset->FlatAppearance->BorderSize = 0;
			this->buttonReset->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonReset->Font = (gcnew System::Drawing::Font(L"Impact", 15.75F));
			this->buttonReset->Location = System::Drawing::Point(1, 344);
			this->buttonReset->Margin = System::Windows::Forms::Padding(0);
			this->buttonReset->Name = L"buttonReset";
			this->buttonReset->Size = System::Drawing::Size(243, 32);
			this->buttonReset->TabIndex = 11;
			this->buttonReset->Text = L"Reset";
			this->buttonReset->UseVisualStyleBackColor = false;
			this->buttonReset->Click += gcnew System::EventHandler(this, &G2048::buttonReset_Click);
			// 
			// buttonLeft
			// 
			this->buttonLeft->BackColor = System::Drawing::Color::White;
			this->buttonLeft->FlatAppearance->BorderSize = 0;
			this->buttonLeft->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonLeft->Font = (gcnew System::Drawing::Font(L"Impact", 20));
			this->buttonLeft->Location = System::Drawing::Point(1, 278);
			this->buttonLeft->Margin = System::Windows::Forms::Padding(0);
			this->buttonLeft->Name = L"buttonLeft";
			this->buttonLeft->Size = System::Drawing::Size(70, 65);
			this->buttonLeft->TabIndex = 12;
			this->buttonLeft->Text = L"←";
			this->buttonLeft->UseVisualStyleBackColor = false;
			this->buttonLeft->Click += gcnew System::EventHandler(this, &G2048::buttonMove_Click);
			// 
			// buttonDown
			// 
			this->buttonDown->BackColor = System::Drawing::Color::White;
			this->buttonDown->FlatAppearance->BorderSize = 0;
			this->buttonDown->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonDown->Font = (gcnew System::Drawing::Font(L"Impact", 15));
			this->buttonDown->Location = System::Drawing::Point(72, 311);
			this->buttonDown->Margin = System::Windows::Forms::Padding(0);
			this->buttonDown->Name = L"buttonDown";
			this->buttonDown->Size = System::Drawing::Size(101, 32);
			this->buttonDown->TabIndex = 13;
			this->buttonDown->Text = L"↓";
			this->buttonDown->UseVisualStyleBackColor = false;
			this->buttonDown->Click += gcnew System::EventHandler(this, &G2048::buttonMove_Click);
			// 
			// buttonUp
			// 
			this->buttonUp->BackColor = System::Drawing::Color::White;
			this->buttonUp->FlatAppearance->BorderSize = 0;
			this->buttonUp->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonUp->Font = (gcnew System::Drawing::Font(L"Impact", 15));
			this->buttonUp->Location = System::Drawing::Point(72, 278);
			this->buttonUp->Margin = System::Windows::Forms::Padding(0);
			this->buttonUp->Name = L"buttonUp";
			this->buttonUp->Size = System::Drawing::Size(101, 32);
			this->buttonUp->TabIndex = 14;
			this->buttonUp->Text = L"↑";
			this->buttonUp->UseVisualStyleBackColor = false;
			this->buttonUp->Click += gcnew System::EventHandler(this, &G2048::buttonMove_Click);
			// 
			// buttonRight
			// 
			this->buttonRight->BackColor = System::Drawing::Color::White;
			this->buttonRight->FlatAppearance->BorderSize = 0;
			this->buttonRight->FlatStyle = System::Windows::Forms::FlatStyle::Flat;
			this->buttonRight->Font = (gcnew System::Drawing::Font(L"Impact", 20, System::Drawing::FontStyle::Bold));
			this->buttonRight->Location = System::Drawing::Point(174, 278);
			this->buttonRight->Margin = System::Windows::Forms::Padding(0);
			this->buttonRight->Name = L"buttonRight";
			this->buttonRight->Size = System::Drawing::Size(70, 65);
			this->buttonRight->TabIndex = 15;
			this->buttonRight->Text = L"→";
			this->buttonRight->UseVisualStyleBackColor = false;
			this->buttonRight->Click += gcnew System::EventHandler(this, &G2048::buttonMove_Click);
			// 
			// G2048
			// 
			this->AutoScaleDimensions = System::Drawing::SizeF(6, 13);
			this->AutoScaleMode = System::Windows::Forms::AutoScaleMode::Font;
			this->BackColor = System::Drawing::Color::Black;
			this->ClientSize = System::Drawing::Size(245, 377);
			this->Controls->Add(this->buttonRight);
			this->Controls->Add(this->buttonUp);
			this->Controls->Add(this->buttonDown);
			this->Controls->Add(this->buttonLeft);
			this->Controls->Add(this->buttonReset);
			this->Controls->Add(this->toolBar);
			this->FormBorderStyle = System::Windows::Forms::FormBorderStyle::None;
			this->Name = L"G2048";
			this->Text = L"GameForm";
			this->toolBar->ResumeLayout(false);
			this->ResumeLayout(false);

		}
#pragma endregion

		// Основные игровые методы
		void InitializeGame();
		void AddRandomTile();
		void UpdateView();
		void Move(Char dir);
		void GameReload();

		// Обработчики событий
		void buttonClose_Click(System::Object^ sender, System::EventArgs^ e);
		void buttonClose_MouseLeave(System::Object^ sender, System::EventArgs^ e);
		void buttonClose_MouseEnter(System::Object^ sender, System::EventArgs^ e);
		void buttonMinimize_Click(System::Object^ sender, System::EventArgs^ e);
		void toolBar_MouseDown(System::Object^ sender, System::Windows::Forms::MouseEventArgs^ e);
		void toolBar_MouseMove(System::Object^ sender, System::Windows::Forms::MouseEventArgs^ e);
		void toolBar_MouseUp(System::Object^ sender, System::Windows::Forms::MouseEventArgs^ e);
		void buttonReset_Click(System::Object^ sender, System::EventArgs^ e);
		void buttonMove_Click(System::Object^ sender, System::EventArgs^ e);
	};

} // namespace GameLauncher
